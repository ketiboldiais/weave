# Twine
Weave uses a language called Twine to parse and evaluate user-defined functions. Initially designed for unit conversions in Twine’s matrix operations, the language gradually evolved into its current form, a scripting language that transpiles to JavaScript.

## Mathematical Expressions
All Twine math expressions are subtypes of `Expression`. An `Expression`, by definition, has the following properties and methods:

:::definition
### Property: parenLevel
For every expression ${E,}$ there exists a property

$$
	E.\texttt{parenLevel}
$$

corresponding to the parenthesis level of ${E.}$
:::

__Example.__ The expression `2x^2 - 1` has a `parenLevel` of 0.

__Example.__ The expression `(ab + c)` has a `parenLevel` of 1.

__Example.__ In the example below, notice that `b` has a parenLevel of ${0.}$ The expression `(2x-2)(3x + 1)` is syntactic sugar for the single, complete expression of variable `a`: `6x^2 - 4x - 2`, which contains no parentheses.


| Property                            | Type       | Definition                                                           |
| ----------------------------------- | ---------- | -------------------------------------------------------------------- |
| :ref[`parenLevel`]{id="parenLevel"} | _`number`_ | A natural number corresponding to the expressions parentheses level. |

| Method        | Parameters | Returns     | Definition                                                                                           |
| ------------- | ---------- | ----------- | ---------------------------------------------------------------------------------------------------- |
| `tickParen`   |            | `this`      | Increments the expression’s [`parenLevel`](#parenLevel)                                              |
| `isAlgebraic` |            | _`boolean`_ | Returns true if the expression is an [AlgebraicExpression](#algebraic-expressions), false otherwise. |
| `isUndefined` |            | _`boolean`_ | Returns true if the expression is the [Undefined](#undefined), false otherwise.                      |
| `isInt`       |            | _`boolean`_ | Returns true if the expression is an [integer](#int), false otherwise.                               |
| `isSym` | | _`boolean`_ | Returns true if the expession is a `Sym`, false otherwise |


The expression class is partitioned in two: `Atom` and `Compound`:

:::hstack

| Subclass | Type   |
| -------- | ------ |
| `Atom`   | `Int`  |
|          | `Real` |
|          | `Sym`  |

| Subclass   | Type           | Operators                                          |
| ---------- | -------------- | -------------------------------------------------- |
| `Compound` | `AlgebraicOp`  | `+` `-` `*` `^` `/` `!`                            |
|            | `LogicalOp`    | `not` `and` `nand` `or` `nor` `xor` `xnor`         |
|            | `RelationalOp` | `<` `>` `<=` `>=` `==` `!=`                        |
|            | `SetOp`        | `{}` `\|` `&` `~`                                  |
|            | `ListOp`       | `()` `++` `--`                                     |
|            | `AlgebraicFn`  | `cos` `frac` `sin` `tan` `ln` `lg` `log` `call-ax` |
|            | `PlainFn`      | `call-nx`                                          |
:::

## Int 


Atomic expressions are the building blocks of all other expressions. Compound expressions are expressions with an `op` field, corresponding to an operator, and an `operands` field, corresponding to the operands of that operation.

## Algebraic Expressions
Twine recognizes a special union of expressions called the _algebraic expression_:

:::hstack
| Algebraic Expression |
| -------------------- |
| `Int`                |
| `Sym`                |
| `Sum`                |
| `Product`            |
| `Difference`         |
| `Power`              |
| `Quotient`           |
| `Factorial`          |
| `AlgebraicFun`       |
:::

Algebraic expressions are particularly important in Twine: They are the only types that may be used in Twine’s core algebraic functions.

## DNE


## AlgebraicOp
An `AlgebraicOp` corresponds an expression whose operand is from the `core` enum. This enum comprises the following operators:

:::hstack
| Type              | Literal |
| ----------------- | ------- |
| `core.sum`        | `"+"`   |
| `core.product`    | `"*"`   |
| `core.power`      | `"^"`   |
| `core.difference` | `"-"`   |
| `core.quotient`   | `"/"`   |
| `core.factorial`  | `"!"`   |
| `core.fraction`   | `"//"`  |
:::

### Properties of AlgebraicOperations

Below are properties common to all AlgebraicOperations:

| Property   | Type                    | Definition                                                                                                       |
| ---------- | ----------------------- | ---------------------------------------------------------------------------------------------------------------- |
| `op`       | `CoreOp`                | A constant string mapped to by the enum `CoreOp`.                                                                |
| `operands` | `AlgebraicExpression[]` | An array of [algebraic expressions](#algebraic-expressions), corresponding to the algebraic operator’s operands. |

## Sum
::::right
~~~ts
let x = a + b;
let y = 2pi + pi;
let z = sum(1,2,3,4);
~~~
:::figcap
Various sum expressions.
:::
::::
An expression corresponding to an ${n}$-ary sum. That is, an expression of syntax:

$$
	a + b
$$

where ${a}$ and ${b}$ are algebraic expressions. 

:::definition
### Constructor: sum
Let ${operands}$ be an array with elements of type [`algebraicExpression`](#algebraic-expressions). Then the function:

$$
	\texttt{sum}(operands)
$$

returns a new `Sum`.
:::

#### Commutativity of Addition
Recall the algebraic property of commutativity:

:::definition
__Commutativity of Addition.__ Let ${S}$ be an algebra of elements ${a}$ and ${b,}$ and an operation ${\star.}$ We say that ${\star}$ is _commutative_ if, and only if:
$$
	a \star b = b \star a
$$ 
:::

Because sums are associative, they may be _concatenated_ and flattened into ${n}$-ary sums:

$$
	d + (c + b + (e + a)) = (d + c + b + e + a)
$$

And because of commutative, they may _ordered_ following a well-defined order relation (below, a lexicographical ordering):

$$
	(d + c + b + e + a) = (a + b + c + d + e)
$$

Like the [product expression](#product), Twine interprets addition as an ${n}$-ary operation, given the commutative property of addition.


### Properties of Sums
Sums have the following properties:

| Property   | Type                    | Remark                                                       |
| ---------- | ----------------------- | ------------------------------------------------------------ |
| `op`       | `CoreOp.sum`            | The constant string `“+”`.                                   |
| `operands` | `AlgebraicExpression[]` | An array of [algebraic expressions](#algebraic-expressions). |


## Product
::::right
~~~ts
let x = a * b;
let z = (3x - 1)(2x + 1);
~~~
:::figcap
Product expressions.
:::
::::

An expression corresponding to an ${n}$-ary product. In mathematical notation, an expression of syntax:

$$
	ab
$$

where ${a}$ is an algebraic expression and ${b}$ is an algebraic expression.


:::definition
### Constructor: product
Let ${operands}$ be an array with elements of type [`algebraicExpression`](#algebraic-expressions). Then the function:

$$
	\texttt{product}(operands)
$$

returns a new `Product`.
:::

### Properties of Product Expressions
Product expressions have the following properties:


| Property   | Type                    | Remark                                                       |
| ---------- | ----------------------- | ------------------------------------------------------------ |
| `op`       | `CoreOp.product`        | The constant string `“*”`.                                   |
| `operands` | `AlgebraicExpression[]` | An array of [algebraic expressions](#algebraic-expressions). |

## Power

::::right
~~~ts
let x = y^2;
let n = cos(x)^2;
let b = y^-1;
~~~
:::figcap
Power expressions.
:::
::::

An expression corresponding to a power. That is, an expression of syntax:

$$
	a^b
$$

where ${a}$ is an algebraic expression and ${b}$ is an algebraic expression.





